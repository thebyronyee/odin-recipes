YUI.add("hermes-template-scrappy-edit-button",(function(t,e){var n=t.Template.Handlebars.revive({1:function(t,e,n,l,a){var r,o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"\t<div class='edit-button-container'>\n"+(null!=(r=o(n,"if").call(null!=e?e:t.nullContext||{},null!=e?o(e,"isResponsiveMobile"):e,{name:"if",hash:{},fn:t.program(2,a,0),inverse:t.program(4,a,0),data:a,loc:{start:{line:3,column:2},end:{line:11,column:9}}}))?r:"")+"\t</div>\n"},2:function(t,e,n,l,a){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t\t<a href="#" title="'+t.escapeExpression((r(n,"intlMessage")||e&&r(e,"intlMessage")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.EDIT_PHOTO"},data:a,loc:{start:{line:4,column:22},end:{line:4,column:78}}}))+'" class="button">\n\t\t\t\t<svg class="icon icon-more_horizontal"><use xlink:href="#icon-more_horizontal"></use></svg>\n\t\t\t</a>\n'},4:function(t,e,n,l,a){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t\t<a href="#" title="'+t.escapeExpression((r(n,"intlMessage")||e&&r(e,"intlMessage")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.EDIT_PHOTO"},data:a,loc:{start:{line:8,column:22},end:{line:8,column:78}}}))+'" class="button">\n\t\t\t\t<svg class="icon icon-filters"><use xlink:href="#icon-filters"></use></svg>\n\t\t\t</a>\n'},6:function(t,e,n,l,a){var r,o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(r=o(n,"if").call(null!=e?e:t.nullContext||{},null!=e?o(e,"viewerIsOwner"):e,{name:"if",hash:{},fn:t.program(7,a,0),inverse:t.noop,data:a,loc:{start:{line:14,column:1},end:{line:20,column:8}}}))?r:""},7:function(t,e,n,l,a){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t<div class=\'edit\'>\n\t\t\t<a href="#" title="'+t.escapeExpression((r(n,"intlMessage")||e&&r(e,"intlMessage")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.EDIT_PHOTO"},data:a,loc:{start:{line:16,column:22},end:{line:16,column:78}}}))+'" class="button">\n\t\t\t\t<i class="ui-icon-edit"></i>\n\t\t\t</a>\n\t\t</div>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,l,a){var r,o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(r=(o(n,"isFlipped")||e&&o(e,"isFlipped")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"enable-photo-page-lightbox-updates",{name:"isFlipped",hash:{},fn:t.program(1,a,0),inverse:t.program(6,a,0),data:a,loc:{start:{line:1,column:0},end:{line:21,column:14}}}))?r:""},useData:!0}),l={};t.Array.each([],(function(e){var n=t.Template.get("hermes/"+e);n&&(l[e]=n)})),t.Template.register("hermes/scrappy-edit-button",(function(e,a){return(a=a||{}).partials=a.partials?t.merge(l,a.partials):l,n(e,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-scrappy-edit-menu",(function(n,e){var l=n.Template.Handlebars.revive({1:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(a=i(l,"if").call(r,null!=e?i(e,"enableEdit"):e,{name:"if",hash:{},fn:n.program(2,o,0),inverse:n.program(4,o,0),data:o,loc:{start:{line:5,column:2},end:{line:9,column:9}}}))?a:"")+(null!=(a=(i(l,"isFlipped")||e&&i(e,"isFlipped")||n.hooks.helperMissing).call(r,"enable-photo-page-lightbox-updates",{name:"isFlipped",hash:{},fn:n.program(9,o,0),inverse:n.program(11,o,0),data:o,loc:{start:{line:10,column:3},end:{line:17,column:17}}}))?a:"")},2:function(n,e,l,t,o){return'\t\t\t<li><a href="#" class="edit-photo">\n'},4:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t\t<li><a href="#" class="unavailable-feature '+(null!=(a=i(l,"if").call(r,null!=e?i(e,"isVideo"):e,{name:"if",hash:{},fn:n.program(5,o,0),inverse:n.noop,data:o,loc:{start:{line:8,column:46},end:{line:8,column:75}}}))?a:"")+'" '+(null!=(a=i(l,"if").call(r,null!=e?i(e,"isVideo"):e,{name:"if",hash:{},fn:n.program(7,o,0),inverse:n.noop,data:o,loc:{start:{line:8,column:77},end:{line:8,column:175}}}))?a:"")+">\n"},5:function(n,e,l,t,o){return"isVideo"},7:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'title="'+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.NO_VIDEOS_IN_EDITOR"},data:o,loc:{start:{line:8,column:99},end:{line:8,column:164}}}))+'"}}"'},9:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-editor.OPEN_PHOTO_EDITOR"},data:o,loc:{start:{line:11,column:4},end:{line:11,column:61}}}))+'\n\t\t\t\t</a></li>\n\t\t\t\t<li class="divider"></li>\n'},11:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-editor.EDIT"},data:o,loc:{start:{line:15,column:4},end:{line:15,column:48}}}))+"\n\t\t\t\t</a></li>\n"},13:function(n,e,l,t,o){var a,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return null!=(a=r(l,"if").call(null!=e?e:n.nullContext||{},null!=e?r(e,"showPrintsLink"):e,{name:"if",hash:{},fn:n.program(14,o,0),inverse:n.noop,data:o,loc:{start:{line:21,column:2},end:{line:24,column:9}}}))?a:""},14:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t\t<li><a href="#" class="print-photo">'+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"prints.BUY_PRINTS"},data:o,loc:{start:{line:22,column:39},end:{line:22,column:83}}}))+'</a></li>\n\t\t\t<li class="divider"></li>\n'},16:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t<li><a href="#" class="rotate-photo '+(null!=(a=i(l,"if").call(r,null!=e?i(e,"isVideo"):e,{name:"if",hash:{},fn:n.program(17,o,0),inverse:n.noop,data:o,loc:{start:{line:28,column:38},end:{line:28,column:87}}}))?a:"")+'" '+(null!=(a=i(l,"if").call(r,null!=e?i(e,"isVideo"):e,{name:"if",hash:{},fn:n.program(19,o,0),inverse:n.noop,data:o,loc:{start:{line:28,column:89},end:{line:28,column:182}}}))?a:"")+">\n\t\t\t"+n.escapeExpression((i(l,"intlMessage")||e&&i(e,"intlMessage")||n.hooks.helperMissing).call(r,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ROTATE"},data:o,loc:{start:{line:29,column:3},end:{line:29,column:55}}}))+"\n\t\t</a></li>\n"},17:function(n,e,l,t,o){return"isVideo unavailable-feature"},19:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'title="'+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.NO_VIDEO_ROTATION"},data:o,loc:{start:{line:28,column:111},end:{line:28,column:174}}}))+'"'},21:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t<li><a href="#" class="replace-photo '+(null!=(a=i(l,"if").call(r,null!=e?i(e,"isVideo"):e,{name:"if",hash:{},fn:n.program(17,o,0),inverse:n.noop,data:o,loc:{start:{line:34,column:39},end:{line:34,column:88}}}))?a:"")+'" '+(null!=(a=i(l,"if").call(r,null!=e?i(e,"isVideo"):e,{name:"if",hash:{},fn:n.program(22,o,0),inverse:n.noop,data:o,loc:{start:{line:34,column:90},end:{line:34,column:182}}}))?a:"")+">\n\t\t\t"+n.escapeExpression((i(l,"intlMessage")||e&&i(e,"intlMessage")||n.hooks.helperMissing).call(r,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.REPLACE"},data:o,loc:{start:{line:35,column:3},end:{line:35,column:56}}}))+"\n\t\t</a></li>\n"},22:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'title="'+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.NO_VIDEO_REPLACE"},data:o,loc:{start:{line:34,column:112},end:{line:34,column:174}}}))+'"'},24:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t<li><a href="#" class="delete-photo">\n\t\t\t'+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.DELETE"},data:o,loc:{start:{line:43,column:3},end:{line:43,column:43}}}))+"\n\t\t</a></li>\n"},26:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(a=i(l,"if").call(r,null!=e?i(e,"showAddToGroup"):e,{name:"if",hash:{},fn:n.program(27,o,0),inverse:n.noop,data:o,loc:{start:{line:48,column:2},end:{line:52,column:9}}}))?a:"")+"\n"+(null!=(a=i(l,"if").call(r,null!=e?i(e,"showAddToGallery"):e,{name:"if",hash:{},fn:n.program(29,o,0),inverse:n.noop,data:o,loc:{start:{line:54,column:2},end:{line:58,column:9}}}))?a:"")},27:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t\t<li><a href="#" class="add-photo-to-group">\n\t\t\t\t'+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_GROUP"},data:o,loc:{start:{line:50,column:4},end:{line:50,column:62}}}))+"\n\t\t\t</a></li>\n"},29:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t\t<li><a href="#" class="add-photo-to-gallery">\n\t\t\t\t'+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_GALLERY"},data:o,loc:{start:{line:56,column:4},end:{line:56,column:64}}}))+"\n\t\t\t</a></li>\n"},compiler:[8,">= 4.3.0"],main:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,s=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<ul class="scrappy-edit-menu">\n\n'+(null!=(a=s(l,"if").call(r,null!=e?s(e,"showEditLink"):e,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.noop,data:o,loc:{start:{line:4,column:1},end:{line:18,column:9}}}))?a:"")+"\n"+(null!=(a=(s(l,"isFlipped")||e&&s(e,"isFlipped")||i).call(r,"enable-photo-page-lightbox-updates",{name:"isFlipped",hash:{},fn:n.program(13,o,0),inverse:n.noop,data:o,loc:{start:{line:20,column:1},end:{line:25,column:15}}}))?a:"")+"\n"+(null!=(a=s(l,"if").call(r,null!=e?s(e,"showRotateLink"):e,{name:"if",hash:{},fn:n.program(16,o,0),inverse:n.noop,data:o,loc:{start:{line:27,column:1},end:{line:31,column:8}}}))?a:"")+"\n"+(null!=(a=s(l,"if").call(r,null!=e?s(e,"showReplaceLink"):e,{name:"if",hash:{},fn:n.program(21,o,0),inverse:n.noop,data:o,loc:{start:{line:33,column:1},end:{line:37,column:8}}}))?a:"")+"\n\n"+(null!=(a=s(l,"if").call(r,null!=e?s(e,"showDeleteLink"):e,{name:"if",hash:{},fn:n.program(24,o,0),inverse:n.noop,data:o,loc:{start:{line:41,column:1},end:{line:45,column:8}}}))?a:"")+"\n"+(null!=(a=(s(l,"isFlipped")||e&&s(e,"isFlipped")||i).call(r,"enable-photo-page-lightbox-updates",{name:"isFlipped",hash:{},fn:n.program(26,o,0),inverse:n.noop,data:o,loc:{start:{line:47,column:1},end:{line:59,column:15}}}))?a:"")+"\n</ul>\n"},useData:!0}),t={};n.Array.each([],(function(e){var l=n.Template.get("hermes/"+e);l&&(t[e]=l)})),n.Template.register("hermes/scrappy-edit-menu",(function(e,o){return(o=o||{}).partials=o.partials?n.merge(t,o.partials):t,l(e,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-replace-photo-dialog-content",(function(e,n){var l=e.Template.Handlebars.revive({1:function(e,n,l,t,a){var o,r=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(o=r(l,"if").call(null!=n?n:e.nullContext||{},null!=n?r(n,"photoTitle"):n,{name:"if",hash:{},fn:e.program(2,a,0),inverse:e.program(4,a,0),data:a,loc:{start:{line:2,column:1},end:{line:6,column:8}}}))?o:""},2:function(e,n,l,t,a){var o=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"\t\t"+e.escapeExpression((o(l,"intlMessage")||n&&o(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{fileName:null!=n?o(n,"fileName"):n,photoTitle:null!=n?o(n,"photoTitle"):n,intlName:"photo-page-scrappy.PERMANENTLY_REPLACE_PHOTO_TITLE"},data:a,loc:{start:{line:3,column:2},end:{line:3,column:119}}}))+"\n"},4:function(e,n,l,t,a){var o=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"\t\t"+e.escapeExpression((o(l,"intlMessage")||n&&o(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{fileName:null!=n?o(n,"fileName"):n,intlName:"photo-page-scrappy.PERMANENTLY_REPLACE_NO_PHOTO_TITLE"},data:a,loc:{start:{line:5,column:2},end:{line:5,column:100}}}))+"\n"},6:function(e,n,l,t,a){var o=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"\t"+e.escapeExpression((o(l,"intlMessage")||n&&o(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.REPLACE_WARNING"},data:a,loc:{start:{line:8,column:1},end:{line:8,column:62}}}))+'\n\t<input class="replace-photo-file-input" type="file" name="file" accept="image/*">\n'},compiler:[8,">= 4.3.0"],main:function(e,n,l,t,a){var o,r=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(o=r(l,"if").call(null!=n?n:e.nullContext||{},null!=n?r(n,"fileName"):n,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(6,a,0),data:a,loc:{start:{line:1,column:0},end:{line:10,column:7}}}))?o:""},useData:!0}),t={};e.Array.each([],(function(n){var l=e.Template.get("hermes/"+n);l&&(t[n]=l)})),e.Template.register("hermes/replace-photo-dialog-content",(function(n,a){return(a=a||{}).partials=a.partials?e.merge(t,a.partials):t,l(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-rotate-photo-dialog-content",(function(t,a){var e=t.Template.Handlebars.revive({1:function(t,a,e,n,i){return"c-rotations-portrait"},compiler:[8,">= 4.3.0"],main:function(t,a,e,n,i){var r,l=t.lambda,o=t.escapeExpression,s=t.lookupProperty||function(t,a){if(Object.prototype.hasOwnProperty.call(t,a))return t[a]};return'<div class="rotate-photo-dialog-container '+(null!=(r=(s(e,"ifCond")||a&&s(a,"ifCond")||t.hooks.helperMissing).call(null!=a?a:t.nullContext||{},null!=(r=null!=a?s(a,"preview"):a)?s(r,"width"):r,"<",null!=(r=null!=a?s(a,"preview"):a)?s(r,"height"):r,{name:"ifCond",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i,loc:{start:{line:1,column:42},end:{line:1,column:117}}}))?r:"")+'">\n\t<div class="rotation-container">\n\t\t<div class="rotated-image rotate-90">\n\t\t\t<div class="square"></div>\n\t\t\t<img src="'+o(l(null!=(r=null!=a?s(a,"preview"):a)?s(r,"url"):r,a))+'" data-action="select" data-rotation="90">\n\t\t</div>\n\t</div>\n\t<div class="rotation-container">\n\t\t<div class="rotated-image rotate-180">\n\t\t\t<div class="square"></div>\n\t\t\t<img src="'+o(l(null!=(r=null!=a?s(a,"preview"):a)?s(r,"url"):r,a))+'" data-action="select" data-rotation="180">\n\t\t</div>\n\t</div>\n\t<div class="rotation-container">\n\t\t<div class="rotated-image rotate-270">\n\t\t\t<div class="square"></div>\n\t\t\t<img src="'+o(l(null!=(r=null!=a?s(a,"preview"):a)?s(r,"url"):r,a))+'" data-action="select" data-rotation="270">\n\t\t</div>\n\t</div>\n</div>\n'},useData:!0}),n={};t.Array.each([],(function(a){var e=t.Template.get("hermes/"+a);e&&(n[a]=e)})),t.Template.register("hermes/rotate-photo-dialog-content",(function(a,i){return(i=i||{}).partials=i.partials?t.merge(n,i.partials):n,e(a,i)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-well-scrappy-edit-view",(function(e,t){var o=require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.nsid=t.nsid,this.photoId=t.photoId,this.backToURL=t.backToURL,this.context=t.context,""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("scrappy-edit-button",{loadingView:!0}),this.editorParams={nsid:this.nsid,photoId:this.photoId,backToURL:this.backToURL},this.appContext.flipper.isFlipped("enable-photo-page-lightbox-updates")&&(this.isResponsiveMobile=t.isResponsiveMobile,this.photoPrintsHelper=new e.PhotoPrintsHelper(this.appContext),this.curationHelper=new e.CurationHelper(this.appContext,{view:this})),this},loadState:function(){var t=this;return this.appContext.getViewer().signedIn?e.Promise.all([this.appContext.getModel("photo-models",t.photoId)]).then((o=>{var i=o[0],n=[];return t.set("photo",i),this.appContext.flipper.isFlipped("enable-photo-page-lightbox-updates")&&n.push(this.appContext.getModel("person-relationship-models",i.getValue("owner").getValue("nsid")).then((e=>{this.set("relationshipModel",e)}))),i.getValue("owner").getValue("isMe")&&!t.appContext.forceServerRender&&n.push(t.appContext.getModel(t.context.modelName,t.context.params).then((function(e){t.set("contextModel",e)})).then((function(){var o=e.merge(t.context.params,{photoId:t.photoId,numNext:1,numPrev:1});return t.get("contextModel").getValue("photoContextList").getContext(o).then((function(){var e,o=t.get("contextModel").getValue("photoContextList").getList(),i=o.length;(e=o.map((function(e){return e.getValue("id")})).indexOf(t.photoId))>=0&&e<i&&t.set("nextPhotoModel",o[e+1]),e>0&&t.set("prevPhotoModel",o[e-1])}))}))),e.Promise.all(n)})):e.Promise.resolve()},buildContainer:function(){var e=!1;return this.appContext.getViewer().signedIn&&(e=this.get("photo").getValue("owner").getValue("isMe")),this.setContainerWithTemplate("scrappy-edit-button",{viewerIsOwner:e,isResponsiveMobile:this.isResponsiveMobile&&this.appContext.flipper.isFlipped("enable-photo-page-lightbox-updates")}),this},activate:function(){var e=this.get("container");return e&&this.registerEventHandler(e.on("click",this.handleMenuButtonClick,this)),this},setupDropdown:function(t){var o,i,n=this.get("container"),a=this.get("photo"),s=a.getValue("owner").getValue("isMe"),l=!1,r=a.getValue("isVideo"),p=a.getValue("id"),h=this.appContext.getViewer().signedIn;s&&(l=!0),o=e.URLHelper.getPhotoPage({photoId:a.getValue("id"),pathAlias:a.getValue("owner").getValue("pathAlias")}),i=this.templates("scrappy-edit-menu")({photoURL:o,photoId:p,viewerIsOwner:s,showDeleteLink:s,showRotateLink:s&&!r,showReplaceLink:s&&!r,isVideo:r,showEditLink:s&&!r&&!this.isResponsiveMobile,enableEdit:l,showPrintsLink:this.appContext.flipper.isFlipped("enable-photo-page-lightbox-updates")&&this.isResponsiveMobile&&this.photoPrintsHelper.canPrintPhoto(a,this.get("relationshipModel")),showAddToGroup:this.appContext.flipper.isFlipped("enable-photo-page-lightbox-updates")&&this.isResponsiveMobile&&h&&!s,showAddToGallery:this.appContext.flipper.isFlipped("enable-photo-page-lightbox-updates")&&this.isResponsiveMobile&&h&&!s}),this.editMenu&&(this.editMenu.close(),this.editMenu=null),this.editMenu=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,preferTop:!0,showDropArrow:!0,anchorOffsetVertical:10,width:170,anchorElement:this.appContext.flipper.isFlipped("enable-photo-page-lightbox-updates")?n.one(".edit-button-container"):n.one(".edit"),htmlMessage:i,closeOnScroll:!1,classList:"dialog-tooltip",autoSizeToContent:!0}),this.editMenu.on("activated",(function(o){e.use("photo-editor-view",t)})),this.editMenu.show()},handleMenuButtonClick:function(t){var o=this;t.preventDefault(),e.rapidTracker.beacon(this.name,"editMenuClick"),this.appContext.experiments.fullscreen.getMode()||this.setupDropdown((function(){var e={},t=o.editMenu.get("container");o.appContext.auth.signedIn&&(e.deleteMenuItem=t.one(".delete-photo"),e.deleteMenuItem&&e.deleteMenuItem.on("click",o.handleDeletePhotoClick,o),e.rotateMenuItem=t.one(".rotate-photo"),e.rotateMenuItem&&e.rotateMenuItem.on("click",o.handleRotatePhotoClick,o),e.replaceMenuItem=t.one(".replace-photo"),e.replaceMenuItem&&e.replaceMenuItem.on("click",o.handleReplacePhotoClick,o),e.editorMenuItem=t.one(".edit-photo"),e.editorMenuItem&&e.editorMenuItem.on("click",o.handleEditClick,o),this.appContext.flipper.isFlipped("enable-photo-page-lightbox-updates")&&(e.printMenuItem=t.one(".print-photo"),e.printMenuItem&&e.printMenuItem.on("click",o.handlePrintClick,o),e.addToGroupMenuItem=t.one(".add-photo-to-group"),e.addToGroupMenuItem&&e.addToGroupMenuItem.on("click",o.handleCurateClick,o,"group"),e.addToGalleryMenuItem=t.one(".add-photo-to-gallery"),e.addToGalleryMenuItem&&e.addToGalleryMenuItem.on("click",o.handleCurateClick,o,"gallery")))}))},handleDeletePhotoClick:function(t){var o;t.preventDefault(),this.editMenu.close(),(o=new e.Views.FluidModal({title:this.intlMessage({intlName:"photo-page-scrappy.DELETE_PHOTO"}),actionButtonLabel:this.intlMessage({intlName:"common.DELETE"}),actionButtonIsDangerous:!0,htmlMessage:this.intlMessage({intlName:"photo-page-scrappy.PERMANTENTLY_DELETE"}),appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,showCancelX:!0})).on("actionClick",this.handleDeletePhotoConfirmClick.bind(this)),o.show(),e.rapidTracker.beacon(this.name,"deletePhotoClick")},handleDeletePhotoConfirmClick:function(t){var o,i=this,n=i.get("photo").getValue("owner"),a=i.get("nextPhotoModel"),s=i.get("prevPhotoModel");e.rapidTracker.beacon(this.name,"deletePhotoConfirmationClick"),i.deleteDialog&&i.deleteDialog.close(),this.appContext.callAPI("flickr.photos.delete",{photo_id:this.photoId}).then((function(t){o=a?e.URLHelper.getPhotoPage({photoId:a.getValue("id"),pathAlias:a.getValue("owner").getValue("pathAlias"),contextSuffix:i.get("contextModel").getValue("urlSuffix")}):s?e.URLHelper.getPhotoPage({photoId:s.getValue("id"),pathAlias:s.getValue("owner").getValue("pathAlias"),contextSuffix:i.get("contextModel").getValue("urlSuffix")}):n.getValue("url")+"?deleted="+i.photoId,e.config.win.location=o}),(function(e){i.showErrorDialog(i.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_PHOTO"}))}))},handleReplacePhotoClick:function(t){t.halt();var o=this;this.get("photo").getValue("isVideo")||(this.editMenu.close(),this.replaceDialog=new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"photo-page-scrappy.REPLACE_PHOTO"}),htmlMessage:this.templates("replace-photo-dialog-content")(),confirmButtonText:this.intlMessage({intlName:"common.CHOOSE_FILE"}),cancelButtonText:this.intlMessage({intlName:"common.CANCEL"}),fireModalActionClick:!1,onConfirm:()=>{this.replaceDialog.get("container").one(".replace-photo-file-input").getDOMNode().click()}}),hasSubviewConfigRefactor:!0}).show(),this.replaceDialog.attachEvents({"input change:":e=>{e.halt();var t=e.target.getDOMNode().files[0];t&&this.replaceConfirm(t)},":submit":function(){o.replaceSubmit()}}),this.replaceDialog.on("close",(function(){o._imgFileXhr&&o._imgFileXhr.abort(),o._imgFileXhr=null,o._imgFile=null,this.replaceDialog=null})))},replaceConfirm:function(t){this.replaceDialog.close(),this.replaceDialog=null,this._imgFile=t,this.replaceDialog=new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"photo-page-scrappy.REPLACE_PHOTO"}),htmlMessage:this.templates("replace-photo-dialog-content")({fileName:this._imgFile.name,photoTitle:this.get("photo").getValue("title")}),confirmButtonText:this.intlMessage({intlName:"photo-page-scrappy.REPLACE"}),cancelButtonText:this.intlMessage({intlName:"common.CANCEL"}),fireModalActionClick:!1,onConfirm:(e,t)=>{this.replaceSubmit(t)}}),hasSubviewConfigRefactor:!0}).show()},replaceSubmit:function(t){var i,n,a,s=new FormData,l=this,r=e.config.flickr.api.hostname_client_replace;s.append("api_key",e.SiteKey.getKey()),s.append("csrf",e.config.flickr.csrf.token),s.append("photo",this._imgFile,this._imgFile.name),s.append("photo_id",this.photoId),(i=this._imgFileXhr=new XMLHttpRequest).open("POST",r,!0),i.withCredentials=!0,n=function(t){var n="object"==typeof t?t.target.statusText:t+"",a="ERROR_REPLACING_PHOTO";l.replaceDialog.close(),i.statusText.indexOf("Filetype was not recognised")>0&&(a="ERROR_REPLACING_PHOTO_FILE_TYPE"),l.showErrorDialog(l.intlMessage({intlName:"photo-page-scrappy."+a})),e.config.win.beaconError("Replace error",window.location.href,{err:t,status:i.statusText}),o.error("error during upload",{statusText:n})},a=function(t){var o,a,s;try{(s=document.createElement("div")).innerHTML=t.target.responseText,(a=s.getElementsByTagName("rsp")[0]||"")&&(a=a.getAttribute("stat")||""),(o=s.getElementsByTagName("err")[0]||"")&&(o=o.getAttribute("msg")||"")}catch(e){a="",o=""}if("ok"!==a)return e.config.win.beaconError("Replace error from API response",window.location.href,{err:t.target.responseText,status:i.statusText}),n((a||"empty")+": "+(o||"no message"));l.replaceDialog.close(),window.location.reload()},t.setLoading(!0),i.addEventListener("load",a),i.addEventListener("error",n),i.send(s)},handleRotatePhotoClick:function(t){t.halt();var o=this,i=this.appContext.viewportData.getWidth()<700?104:184;this.get("photo").getValue("isVideo")||(this.editMenu.close(),this.rotateDialog=new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"photo-page-scrappy.ROTATE_PHOTO"}),htmlMessage:this.templates("rotate-photo-dialog-content")({preview:o.get("photo").getSizeToFit({width:i,height:i})}),confirmButtonText:this.intlMessage({intlName:"photo-page-scrappy.ROTATE"}),cancelButtonText:this.intlMessage({intlName:"common.CANCEL"}),fireModalActionClick:!1,onConfirm:(e,t)=>{this.rotateSubmit(t)}}),hasSubviewConfigRefactor:!0}).show(),this.rotateDialog.attachEvents({":select":function(t,i){t.target.ancestor(".rotate-photo-dialog-container").all(".rotated-image").removeClass("c-state-selected"),t.target.ancestor(".rotated-image").addClass("c-state-selected"),o._imgRotation=e.flutil.constrainToValues(i.rotation,["90","180","270"])}}),this.rotateDialog.on("close",(function(){o.rotateDialog=null})))},rotateSubmit:function(t){var i,n=this,a=this.rotateDialog;t&&t.setLoading(!0),this.appContext.callAPI("flickr.photos.transform.rotate",{photo_id:this.photoId,degrees:this._imgRotation||90}).then((function(){setTimeout((function(){a.close(),n.fire("subviewViewEvent","photo:reload")}),2e3)}),(function(t){a&&a.get("container")&&(i=a.get("container").one(".button-container"))&&i.removeClass("loading"),a.close(),n.showErrorDialog(n.intlMessage({intlName:"photo-page-scrappy.ERROR_ROTATING_PHOTO"})),e.config.win.beaconError("Rotation error",window.location.href,t),o.error("error during rotation",{err:t})})),e.rapidTracker.beacon(this.name,"rotatePhotoConfirmationClick")},handleEditClick:function(t){t.halt(),this.editMenu.close(),this.appContext.getView("photo-editor-view",this.editorParams).then((function(e){return e.initialize().then((function(){e.activate()}))})),e.Analytics.sendClick("photo-editor-open-click"),e.rapidTracker.beacon(this.name,"editPhoto")},handleCurateClick:function(t,o){t.halt();var i=this;"fluid-droparound-view"===this.curationHelper.showAddToCuration({photoId:this.get("photo").getValue("id"),showAlbums:!1,showGroups:!0,showGalleries:!0,initialTab:o}).name&&(this.fire("menuOpened"),this.curationHelper.on("curateDroparoundClosed",(function(){i.fire("menuClosed"),i.curateNode.removeClass("active")})),this.curateNode.addClass("active")),e.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"curateClick"},e.Snowplough.getPhotoContextFromModel(this.get("photo")))},handlePrintClick:function(e){e.halt(),"en-us"===this.appContext.lang.toLowerCase()?this.preparePrint():this.showEnglishWarningModal()},preparePrint:function(){var t=this;this.showPreparingPrintModal(),this.photoPrintsHelper.registerPrint(this.get("photo"),e.config.win.location.href).then((function(t){e.config.win.location.href=t.redirectURL})).catch((function(e){t.preparePrintModalSubview.showError(e.message||t.intlMessage({intlName:"prints.SOMETHING_WRONG_PREPARING_PRINT"}))}))},showEnglishWarningModal:function(t){var o=this;this.englishWarningModal=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,showActionButton:!0,actionButtonLabel:this.intlMessage({intlName:"prints.CONTINUE_IN_ENGLISH"}),showCancelButton:!0,cancelButtonLabel:"en-us"===this.appContext.lang.toLowerCase()?this.intlMessage({intlName:"common.GO_BACK_BUTTON"}):this.intlMessage({intlName:"common.CANCEL"}),showCancelX:!1,showHeader:!0,showFooter:!0,title:this.intlMessage({intlName:"prints.ENGLISH_LANGUAGE_AHEAD"}),htmlMessage:this.intlMessage({intlName:"prints.ORDERING_IS_ENGLISH_ONLY"})}),this.englishWarningModal.show(),this.englishWarningModal.on("actionClick",(function(){o.englishWarningModal.close(),setTimeout((function(){o.preparePrint()}),0)}))},showPreparingPrintModal:function(){var t=this;this.preparePrintModalSubview=new e.Views["prepare-print-modal-view"]({appContext:this.appContext}),this.preparingPrintModal=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,subview:this.preparePrintModalSubview,hasSubviewConfigRefactor:!0}),this.preparingPrintModal.show(),this.preparePrintModalSubview.on("retryClicked",(function(){t.preparingPrintModal.close(),setTimeout((function(){t.preparePrint()}),0)})),this.preparePrintModalSubview.on("closeClicked",(function(){t.preparingPrintModal.close()}))},showErrorDialog:function(t){return this.errorDialog=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),htmlMessage:t}),this.errorDialog.show(),this.errorDialog}})}),"@VERSION@",{requires:["flickr-view","flutil","flickr-promise","fluid-modal-view","fluid-droparound-view","hermes-template-scrappy-edit-button","hermes-template-scrappy-edit-menu","hermes-template-replace-photo-dialog-content","hermes-template-rotate-photo-dialog-content","hermes-template-flickr-balls","site-key"],optionalRequires:["hermes-core"],optional:[],langBundles:["common","photo-page-scrappy","photo-editor","prints"]});