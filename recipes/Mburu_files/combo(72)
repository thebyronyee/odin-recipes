YUI.add("curation-helper",(function(e,i){require("hermes-core/flog")(i),e.mix({langBundles:["prints"]},e.Localizable);e.CurationHelper=function(i,o){var r=this,s=o.view;return this.showAddToCuration=function(o){let t,a,n=o.photoId,l=o.customConfig,u=o.anchorNode,d=void 0===o.useViewportType||o.useViewportType,c=o.containerType,p=void 0===o.showAlbums||o.showAlbums,w=void 0!==o.showGalleries&&o.showGalleries,h=void 0===o.showGroups||o.showGroups,m=o.initialTab,v={},f=o.modalSizeConfig||void 0;return m||(m=p?"album":"gallery"),t=l||{photoId:n,initialTab:m,showAlbums:p,showGalleries:w,showGroups:h,inlineGroupCreation:!1,dismissOnSelect:!0,dismissOnCreate:!0,modalSizeConfig:f},t=Object.assign(t,{appContext:i}),v={useViewportType:d,containerType:c,configs:{droparound:{preferTop:!0,width:400,anchorElement:u,keyboardAnchorElement:u},modal:{flexLayout:!0,height:450}}},a=new e.ModalDroparoundHelper(i,v),"droparound"===a.params.containerType||(t.inlineGroupCreation=!0,t.useLargeLayout=!0,t.dismissOnSelect=!1,t.dismissOnCreate=!1),this.curateView=new e.Views["add-to-stuff-view"](t),v.configs.common.subview=this.curateView,a.setParams(v),this.curateWrapperView=a.show(),s.registerEventHandler(a.on("close",(function(e){r.fire("curateDroparoundClosed")}))),this.curateWrapperView},this.showCreationModal=function(o){var r=o.viewName,t=o.customConfig,a=o.overlayClassList,n={appContext:i};n=Object.assign(n,t),this.creationView=new e.Views[r](n),this.creationModal=new e.Views.FluidModal({appContext:i,subview:this.creationView,overlayClassList:a,dismissOnOverlayClick:!1,dismissOnEsc:!1,hasSubviewConfigRefactor:!0}),this.creationModal.show(),s.registerEventHandler(this.creationModal.on("activated",(e=>{this.creationView.focusInitial()})))},this},e.augment(e.CurationHelper,e.EventTarget)}),"@VERSION@",{requires:["event-custom","add-to-stuff-view","album-creation-view","gallery-creation-view","group-creation-view","modal-droparound-helper"],optionalRequires:["hermes-core"]});YUI.add("photo-card-engagement-view",(function(e,t){var n=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("photo-card-engagement-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.set("isActiveViewAgnostic",!0),this.signedIn=this.appContext.getViewer().signedIn,this.params=t,this.config={displayCurate:!("displayCurate"in t)||t.displayCurate,displayShare:"displayShare"in t&&t.displayShare,photoItem:t.photoItem,theme:t.theme,enableFaveKey:t.enableFaveKey},this.config.displayCurate=this.config.displayCurate&&this.signedIn,t.subviewParams={"like-engagement-item-view":{photoId:t.photoItem.photoId,showCount:!0,size:"small",isPadded:!1,theme:"overlay"===this.config.theme?"light":void 0},"fluid-share-photo-view":{photoId:t.photoItem.photoId,nsid:t.photoItem.owner.nsid,size:"small",theme:"light"}},this.curationHelper=new e.CurationHelper(this.appContext,{view:this})},subviewConfig:{"like-engagement-item-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["engagement-item","like"],disabled:function(){return!this.appContext.flipper.isFlipped("enable-likes")}},"fluid-share-photo-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["engagement-item","share"]}},buildContainer:function(){this.setContainerWithTemplate("photo-card-engagement",this.config)},activate:function(){var e=this.get("container");this.faveNode=e.one(".engagement-item.fave"),this.commentNode=e.one(".engagement-item.comment"),this.curateNode=e.one(".engagement-item.curate"),this.faveNode&&(this.faveCountNode=this.faveNode.one(".engagement-count"),this.registerEventHandler(this.faveNode.on(["click","key"],this.handleFaveClick.bind(this),"down:13")),this.config.enableFaveKey&&(this.keyEventHandler=this.attachKeyEvent("down:70",this.handleFaveKeyPress.bind(this)))),this.commentNode&&(this.commentIcon=this.commentNode.one(".engagement-icon"),this.commentCountNode=this.commentNode.one(".engagement-count"),this.registerEventHandler(this.commentNode.on(["click","key"],this.handleCommentClick.bind(this),"down:13"))),this.curateNode&&this.registerEventHandler(this.curateNode.on(["click","key"],this.handleCurateClick.bind(this),"down:13")),this.commentCountNode&&this.config.photoItem.engagementModel.on("valuesChanged",(e=>{if(e.commentCount){var t=e.commentCount.newVal;this.commentCountNode.set("text",e.commentCount.newVal),this.commentCountNode.toggleClass("empty",0===t)}}))},handleFaveKeyPress:function(e){70===e.keyCode&&this.handleFaveClick(e)},handleFaveClick:function(t){var i,o=this,s=this.faveNode,a=this.faveCountNode;this.faveNode.hasClass("can-not-fave")||(this.signedIn?this.isFaving||(this.isFaving=!0,this.config.photoItem.engagementModel.toggleFave(),i=this.config.photoItem.engagementModel.getValue("faveCount"),s.toggleClass("faved",this.config.photoItem.engagementModel.getValue("isFaved")),a.toggleClass("empty",0===i),a&&i>0?a.set("text",i):a.set("text",""),this.config.photoItem.engagementModel.remoteUpdate().then((function(){o.isFaving=!1}),(function(e){3!==e.code&&(o.config.photoItem.engagementModel.toggleFave(),s.toggleClass("faved",o.config.photoItem.engagementModel.getValue("isFaved")),a&&(a.set("text",i),a.toggleClass("empty",0===i))),n.error("Error faving photo",{err:e}),o.isFaving=!1}))):this.showSignUpAndFaveModal(this.config.photoItem.photoId,e.config.win.location.href))},handleCommentClick:function(){var t=this,n={appContext:this.appContext,photoId:this.config.photoItem.photoId,isScrollable:!0},i=this.config.photoItem.engagementModel.getValue("commentCount");if(this.signedIn||0!==i){var o=new e.ModalDroparoundHelper(this.appContext,{configs:{common:{subviewName:"photo-comments-view"},droparound:{subviewParams:n,preferTop:!0,width:400,height:400,anchorElement:this.commentIcon,keyboardAnchorElement:this.commentNode},modal:{subviewParams:Object.assign({},n,{hasHeader:!0}),height:550,flexLayout:!0}}});o.show(),t.registerEventHandler(e.on("addComment:showingSignupModal",(function(){o.close()}))),t.registerEventHandler(o.on("close",(function(){t.commentNode.removeClass("active"),t.fire("menuClosed")}))),this.commentNode.addClass("active"),this.fire("menuOpened")}else this.showSignUpAndCommentModal()},handleCurateClick:function(){var e=this,t=this.config.photoItem.isOwner;"fluid-droparound-view"===this.curationHelper.showAddToCuration({photoId:this.config.photoItem.photoId,showAlbums:t,showGalleries:!t,anchorNode:this.curateNode}).name&&(this.fire("menuOpened"),this.curationHelper.on("curateDroparoundClosed",(function(){e.fire("menuClosed"),e.curateNode.removeClass("active")})),this.curateNode.addClass("active"))},showSignUpAndFaveModal:function(t,n){var i,o=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),s=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"});i=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:o,signUpMessage:s,beaconPrefix:"fave"}),this.registerEventHandler(i.on("signUpClick",(function(i){e.SigninHelper.signUpPendingFave({id:t},{postLoginUrl:n})}))),this.registerEventHandler(i.on("signInClick",(function(i){e.SigninHelper.addPendingFave({id:t},{postLoginUrl:n})}))),i.show()},showSignUpAndCommentModal:function(){var t,n=e.config.win.location.href,i=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_TITLE"}),o=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_MESSAGE"});(t=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-upload",signUpTitle:i,signUpMessage:o,beaconPrefix:"addComment"})).on("signUpClick",(()=>{e.SigninHelper._redirectToSignUp("",{postLoginUrl:n})})),t.on("signInClick",(()=>{e.SigninHelper._redirectToSignin("",{postLoginUrl:n})})),t.show()},toggleCommentNode:function(e){this.commentNode&&this.commentNode.toggleClass("hidden",!e)},toggleFaveNode:function(e){this.faveNode&&this.faveNode.toggleClass("hidden",!e)}})}),"@VERSION@",{requires:["flickr-view","photo-comments-view","fluid-share-photo-view","hermes-template-photo-card-engagement","curation-helper","modal-droparound-helper"],optionalRequires:["hermes-core"],langBundles:["common","comments","fave-view","photo-page-scrappy"]});YUI.add("hermes-lang-fave-view",(function(e,t){e.Intl.add("hermes/fave-view","en-US",{COULDNT_FAVE:[{type:0,value:"We couldn’t fave at this time"}],SIGN_IN_TO_FAVE:[{type:0,value:"You must be signed in to fave. Please sign in now."}],LOADING_FAVES:[{type:0,value:"Loading Faves..."}],UNFAVE_PHOTO:[{type:0,value:"Unfave this photo"}],FAVE_PHOTO:[{type:0,value:"Fave this photo"}],WHO_FAVED:[{type:0,value:"Who faved this photo"}],SIGN_IN_BEFORE_FAVE_TITLE:[{type:0,value:"You found a photo to fave!"}],SIGN_IN_BEFORE_FAVE_MESSAGE:[{type:0,value:"That’s great. Just sign in to fave it."}],SIGN_IN_AND_FAVE:[{type:0,value:"Sign in and fave"}],JOIN_FLICKR_AND_FAVE:[{type:0,value:"Join Flickr to add this photo to your favorites."}]})}),"@VERSION@",{requires:["intl"]});