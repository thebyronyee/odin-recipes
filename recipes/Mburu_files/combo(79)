YUI.add("hermes-template-photo-well",(function(n,l){var e=n.Template.Handlebars.revive({1:function(n,l,e,a,t){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=r(e,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"isResponsiveMobile"):l,{name:"if",hash:{},fn:n.program(2,t,0),inverse:n.program(4,t,0),data:t,loc:{start:{line:2,column:1},end:{line:12,column:8}}}))?o:""},2:function(n,l,e,a,t){var o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t"+n.escapeExpression((o(e,"outlet")||l&&o(l,"outlet")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},null!=l?o(l,"mobile-photo-well-view"):l,{name:"outlet",hash:{},data:t,loc:{start:{line:3,column:2},end:{line:3,column:35}}}))+"\n"},4:function(n,l,e,a,t){var o,r=null!=l?l:n.nullContext||{},i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t<a class="navigate-target navigate-prev'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"prev-is-not-clickable"):l,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.noop,data:t,loc:{start:{line:5,column:41},end:{line:5,column:86}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-hidden"):l,{name:"if",hash:{},fn:n.program(7,t,0),inverse:n.noop,data:t,loc:{start:{line:5,column:86},end:{line:5,column:120}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-video"):l,{name:"if",hash:{},fn:n.program(9,t,0),inverse:n.noop,data:t,loc:{start:{line:5,column:120},end:{line:5,column:152}}}))?o:"")+'" href="'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"prev-url"):l,{name:"if",hash:{},fn:n.program(11,t,0),inverse:n.program(13,t,0),data:t,loc:{start:{line:5,column:160},end:{line:5,column:204}}}))?o:"")+'" title="'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"prev-url"):l,{name:"if",hash:{},fn:n.program(15,t,0),inverse:n.noop,data:t,loc:{start:{line:5,column:213},end:{line:5,column:250}}}))?o:"")+'"  data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n\t\t<a class="navigate-target-arrow-only navigate-target navigate-prev'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"prev-is-not-clickable"):l,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.noop,data:t,loc:{start:{line:6,column:68},end:{line:6,column:113}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-hidden"):l,{name:"if",hash:{},fn:n.program(7,t,0),inverse:n.noop,data:t,loc:{start:{line:6,column:113},end:{line:6,column:147}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-video"):l,{name:"if",hash:{},fn:n.program(9,t,0),inverse:n.noop,data:t,loc:{start:{line:6,column:147},end:{line:6,column:179}}}))?o:"")+'" href="'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"prev-url"):l,{name:"if",hash:{},fn:n.program(11,t,0),inverse:n.program(13,t,0),data:t,loc:{start:{line:6,column:187},end:{line:6,column:231}}}))?o:"")+'" data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&larr;</span></a>\n\n\t\t'+n.escapeExpression((i(e,"outlet")||l&&i(l,"outlet")||n.hooks.helperMissing).call(r,null!=l?i(l,"photo-well-media-view"):l,{name:"outlet",hash:{},data:t,loc:{start:{line:8,column:2},end:{line:8,column:34}}}))+'\n\n\t\t<a class="navigate-target navigate-next'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"next-is-not-clickable"):l,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.noop,data:t,loc:{start:{line:10,column:41},end:{line:10,column:86}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-hidden"):l,{name:"if",hash:{},fn:n.program(7,t,0),inverse:n.noop,data:t,loc:{start:{line:10,column:86},end:{line:10,column:120}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-video"):l,{name:"if",hash:{},fn:n.program(9,t,0),inverse:n.noop,data:t,loc:{start:{line:10,column:120},end:{line:10,column:152}}}))?o:"")+'" href="'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"next-url"):l,{name:"if",hash:{},fn:n.program(17,t,0),inverse:n.program(13,t,0),data:t,loc:{start:{line:10,column:160},end:{line:10,column:204}}}))?o:"")+'" title="'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"next-url"):l,{name:"if",hash:{},fn:n.program(19,t,0),inverse:n.noop,data:t,loc:{start:{line:10,column:213},end:{line:10,column:250}}}))?o:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n\t\t<a class="navigate-target-arrow-only navigate-target navigate-next'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"next-is-not-clickable"):l,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.noop,data:t,loc:{start:{line:11,column:68},end:{line:11,column:113}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-hidden"):l,{name:"if",hash:{},fn:n.program(7,t,0),inverse:n.noop,data:t,loc:{start:{line:11,column:113},end:{line:11,column:147}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-video"):l,{name:"if",hash:{},fn:n.program(9,t,0),inverse:n.noop,data:t,loc:{start:{line:11,column:147},end:{line:11,column:179}}}))?o:"")+'" href="'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"next-url"):l,{name:"if",hash:{},fn:n.program(17,t,0),inverse:n.program(13,t,0),data:t,loc:{start:{line:11,column:187},end:{line:11,column:231}}}))?o:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n'},5:function(n,l,e,a,t){return" no-click"},7:function(n,l,e,a,t){return" is-hidden"},9:function(n,l,e,a,t){return" is-video"},11:function(n,l,e,a,t){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(o=null!=(o=r(e,"prev-url")||(null!=l?r(l,"prev-url"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"prev-url",hash:{},data:t,loc:{start:{line:5,column:176},end:{line:5,column:188}}}):o)},13:function(n,l,e,a,t){return"#"},15:function(n,l,e,a,t){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(o=null!=(o=r(e,"prev-title")||(null!=l?r(l,"prev-title"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"prev-title",hash:{},data:t,loc:{start:{line:5,column:229},end:{line:5,column:243}}}):o)},17:function(n,l,e,a,t){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(o=null!=(o=r(e,"next-url")||(null!=l?r(l,"next-url"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"next-url",hash:{},data:t,loc:{start:{line:10,column:176},end:{line:10,column:188}}}):o)},19:function(n,l,e,a,t){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(o=null!=(o=r(e,"next-title")||(null!=l?r(l,"next-title"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"next-title",hash:{},data:t,loc:{start:{line:10,column:229},end:{line:10,column:243}}}):o)},21:function(n,l,e,a,t){var o,r=null!=l?l:n.nullContext||{},i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t<a class="navigate-target navigate-prev'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"prev-is-not-clickable"):l,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.noop,data:t,loc:{start:{line:14,column:40},end:{line:14,column:85}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-hidden"):l,{name:"if",hash:{},fn:n.program(7,t,0),inverse:n.noop,data:t,loc:{start:{line:14,column:85},end:{line:14,column:119}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-video"):l,{name:"if",hash:{},fn:n.program(9,t,0),inverse:n.noop,data:t,loc:{start:{line:14,column:119},end:{line:14,column:151}}}))?o:"")+'" href="'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"prev-url"):l,{name:"if",hash:{},fn:n.program(11,t,0),inverse:n.program(13,t,0),data:t,loc:{start:{line:14,column:159},end:{line:14,column:203}}}))?o:"")+'" title="'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"prev-url"):l,{name:"if",hash:{},fn:n.program(15,t,0),inverse:n.noop,data:t,loc:{start:{line:14,column:212},end:{line:14,column:249}}}))?o:"")+'"  data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n\t<a class="navigate-target-arrow-only navigate-target navigate-prev'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"prev-is-not-clickable"):l,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.noop,data:t,loc:{start:{line:15,column:67},end:{line:15,column:112}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-hidden"):l,{name:"if",hash:{},fn:n.program(7,t,0),inverse:n.noop,data:t,loc:{start:{line:15,column:112},end:{line:15,column:146}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-video"):l,{name:"if",hash:{},fn:n.program(9,t,0),inverse:n.noop,data:t,loc:{start:{line:15,column:146},end:{line:15,column:178}}}))?o:"")+'" href="'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"prev-url"):l,{name:"if",hash:{},fn:n.program(11,t,0),inverse:n.program(13,t,0),data:t,loc:{start:{line:15,column:186},end:{line:15,column:230}}}))?o:"")+'" data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&larr;</span></a>\n\n\t'+n.escapeExpression((i(e,"outlet")||l&&i(l,"outlet")||n.hooks.helperMissing).call(r,null!=l?i(l,"photo-well-media-view"):l,{name:"outlet",hash:{},data:t,loc:{start:{line:17,column:1},end:{line:17,column:33}}}))+'\n\n\t<a class="navigate-target navigate-next'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"next-is-not-clickable"):l,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.noop,data:t,loc:{start:{line:19,column:40},end:{line:19,column:85}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-hidden"):l,{name:"if",hash:{},fn:n.program(7,t,0),inverse:n.noop,data:t,loc:{start:{line:19,column:85},end:{line:19,column:119}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-video"):l,{name:"if",hash:{},fn:n.program(9,t,0),inverse:n.noop,data:t,loc:{start:{line:19,column:119},end:{line:19,column:151}}}))?o:"")+'" href="'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"next-url"):l,{name:"if",hash:{},fn:n.program(17,t,0),inverse:n.program(13,t,0),data:t,loc:{start:{line:19,column:159},end:{line:19,column:203}}}))?o:"")+'" title="'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"next-url"):l,{name:"if",hash:{},fn:n.program(19,t,0),inverse:n.noop,data:t,loc:{start:{line:19,column:212},end:{line:19,column:249}}}))?o:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n\t<a class="navigate-target-arrow-only navigate-target navigate-next'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"next-is-not-clickable"):l,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.noop,data:t,loc:{start:{line:20,column:67},end:{line:20,column:112}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-hidden"):l,{name:"if",hash:{},fn:n.program(7,t,0),inverse:n.noop,data:t,loc:{start:{line:20,column:112},end:{line:20,column:146}}}))?o:"")+(null!=(o=i(e,"if").call(r,null!=l?i(l,"is-video"):l,{name:"if",hash:{},fn:n.program(9,t,0),inverse:n.noop,data:t,loc:{start:{line:20,column:146},end:{line:20,column:178}}}))?o:"")+'" href="'+(null!=(o=i(e,"if").call(r,null!=l?i(l,"next-url"):l,{name:"if",hash:{},fn:n.program(17,t,0),inverse:n.program(13,t,0),data:t,loc:{start:{line:20,column:186},end:{line:20,column:230}}}))?o:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n'},23:function(n,l,e,a,t){var o,r=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return(null!=(o=u(e,"if").call(r,null!=l?u(l,"opt-out-enabled"):l,{name:"if",hash:{},fn:n.program(24,t,0),inverse:n.noop,data:t,loc:{start:{line:24,column:1},end:{line:28,column:8}}}))?o:"")+"\n"+(null!=(o=(u(e,"isFlipped")||l&&u(l,"isFlipped")||i).call(r,"enable-photo-page-lightbox-updates",{name:"isFlipped",hash:{},fn:n.program(26,t,0),inverse:n.program(28,t,0),data:t,loc:{start:{line:30,column:1},end:{line:43,column:15}}}))?o:"")+"\n\t"+n.escapeExpression((u(e,"outlet")||l&&u(l,"outlet")||i).call(r,null!=l?u(l,"people-notes-view"):l,{name:"outlet",hash:{},data:t,loc:{start:{line:45,column:1},end:{line:45,column:29}}}))+"\n\n"},24:function(n,l,e,a,t){return'\t<div class="feedback-widget">\n\t\t<button class="ui-button ui-button-cta ui-button-transparent"><span>Opt-out &amp; Feedback</span></button>\n\t</div>\n'},26:function(n,l,e,a,t){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t<header class="header is-hidden">\n\t\t\t<div class="header-container"></div>\n\t\t\t'+n.escapeExpression((r(e,"outlet")||l&&r(l,"outlet")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},null!=l?r(l,"photo-sidebar-toggle-view"):l,{name:"outlet",hash:{},data:t,loc:{start:{line:33,column:3},end:{line:33,column:39}}}))+"\n\t\t</header>\n\n"+(null!=(o=n.invokePartial(r(a,"photo-card-footer"),l,{name:"photo-card-footer",hash:{additionalClasses:"is-hidden",photoConfig:null!=l?r(l,"photoConfig"):l},data:t,indent:"\t\t",helpers:e,partials:a,decorators:n.decorators}))?o:"")},28:function(n,l,e,a,t){var o=null!=l?l:n.nullContext||{},r=n.hooks.helperMissing,i=n.escapeExpression,u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t"+i((u(e,"outlet")||l&&u(l,"outlet")||r).call(o,null!=l?u(l,"photo-sidebar-toggle-view"):l,{name:"outlet",hash:{},data:t,loc:{start:{line:38,column:2},end:{line:38,column:38}}}))+'\n\n\t\t<div class="engagement-container enable-photo-page-lightbox-updates-not-flipped"></div>\n\n\t\t'+i((u(e,"outlet")||l&&u(l,"outlet")||r).call(o,null!=l?u(l,"attribution-view"):l,{name:"outlet",hash:{},data:t,loc:{start:{line:42,column:2},end:{line:42,column:29}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(n,l,e,a,t){var o,r=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,u=n.escapeExpression,c=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return(null!=(o=(c(e,"isFlipped")||l&&c(l,"isFlipped")||i).call(r,"enable-photo-page-lightbox-updates",{name:"isFlipped",hash:{},fn:n.program(1,t,0),inverse:n.program(21,t,0),data:t,loc:{start:{line:1,column:0},end:{line:21,column:14}}}))?o:"")+"\n"+(null!=(o=c(e,"unless").call(r,null!=l?c(l,"is-ad"):l,{name:"unless",hash:{},fn:n.program(23,t,0),inverse:n.noop,data:t,loc:{start:{line:23,column:0},end:{line:47,column:11}}}))?o:"")+"\n"+u((c(e,"outlet")||l&&c(l,"outlet")||i).call(r,null!=l?c(l,"person-menu-view"):l,{name:"outlet",hash:{},data:t,loc:{start:{line:49,column:0},end:{line:49,column:27}}}))+"\n"+u((c(e,"outlet")||l&&c(l,"outlet")||i).call(r,null!=l?c(l,"group-menu-view"):l,{name:"outlet",hash:{},data:t,loc:{start:{line:50,column:0},end:{line:50,column:26}}}))+"\n"},usePartial:!0,useData:!0}),a={};n.Array.each(["photo-card-footer"],(function(l){var e=n.Template.get("hermes/"+l);e&&(a[l]=e)})),n.Template.register("hermes/photo-well",(function(l,t){return(t=t||{}).partials=t.partials?n.merge(a,t.partials):a,e(l,t)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-photo-card-footer"]});YUI.add("hermes-template-feed-error-message",(function(e,n){var r=e.Template.Handlebars.revive({1:function(e,n,r,l,t){var a,o=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t<h2 class="error-title">'+e.escapeExpression("function"==typeof(a=null!=(a=o(r,"title")||(null!=n?o(n,"title"):n))?a:e.hooks.helperMissing)?a.call(null!=n?n:e.nullContext||{},{name:"title",hash:{},data:t,loc:{start:{line:3,column:26},end:{line:3,column:35}}}):a)+"</h2>\n"},3:function(e,n,r,l,t){var a=null!=n?n:e.nullContext||{},o=e.hooks.helperMissing,s=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t<p class="error-message">'+e.escapeExpression((s(r,"preventOrphansHtml")||n&&s(n,"preventOrphansHtml")||o).call(a,(s(r,"renderTrustedMarkup")||n&&s(n,"renderTrustedMarkup")||o).call(a,null!=n?s(n,"message"):n,{name:"renderTrustedMarkup",hash:{},data:t,loc:{start:{line:6,column:48},end:{line:6,column:77}}}),{name:"preventOrphansHtml",hash:{},data:t,loc:{start:{line:6,column:27},end:{line:6,column:79}}}))+"</p>\n"},compiler:[8,">= 4.3.0"],main:function(e,n,r,l,t){var a,o=null!=n?n:e.nullContext||{},s=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<div class="feed-error-message">\n'+(null!=(a=s(r,"if").call(o,null!=n?s(n,"title"):n,{name:"if",hash:{},fn:e.program(1,t,0),inverse:e.noop,data:t,loc:{start:{line:2,column:1},end:{line:4,column:8}}}))?a:"")+(null!=(a=s(r,"if").call(o,null!=n?s(n,"message"):n,{name:"if",hash:{},fn:e.program(3,t,0),inverse:e.noop,data:t,loc:{start:{line:5,column:1},end:{line:7,column:8}}}))?a:"")+"</div>"},useData:!0}),l={};e.Array.each([],(function(n){var r=e.Template.get("hermes/"+n);r&&(l[n]=r)})),e.Template.register("hermes/feed-error-message",(function(n,t){return(t=t||{}).partials=t.partials?e.merge(l,t.partials):l,r(n,t)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("feed-helper",(function(e,t){var a=e.mix({langBundles:["common","feed","feed-new"]},e.Localizable);e.FeedHelper=function(t){var n=new e.PhotoCardHelper(t),r=new e.TemplateLibraryHelper(t),o={photoCardHelper:n,layoutValues:{large:{CARD_SPACING:32,CARD_SPACING_MOBILE:16},medium:{CARD_SPACING:32,TARGET_ROW_HEIGHT:280,TARGET_ROW_HEIGHT_MOBILE:300,TARGET_ROW_HEIGHT_TOLERANCE:.5,GENERATED_LAYOUT_WIDTH:1e3,GENERATED_LAYOUT_SPACING:4,GENERATED_LAYOUT_ROW_HEIGHT_RATIO:.35,GENERATED_LAYOUT_TARGET_ROW_HEIGHT_TOLERANCE:.3,MAX_BATCH_AR:2.5,MIN_BATCH_AR:1},compact:{CARD_SPACING:40,GENERATED_LAYOUT_WIDTH:1e3,GENERATED_LAYOUT_SPACING:4},batchLarge:{CARD_SPACING:16,TARGET_ROW_HEIGHT:320,TARGET_ROW_HEIGHT_MOBILE:300,TARGET_ROW_HEIGHT_TOLERANCE:.3},batchMedium:{CARD_SPACING:32,TARGET_ROW_HEIGHT:320,TARGET_ROW_HEIGHT_MOBILE:300,TARGET_ROW_HEIGHT_TOLERANCE:.3},batchCompact:{CARD_SPACING:32,TARGET_ROW_HEIGHT:320,TARGET_ROW_HEIGHT_MOBILE:300,TARGET_ROW_HEIGHT_TOLERANCE:.3}},EVENT_TYPE_INTL:{Flickrec:{intlName:"feed.RECOMMENDED"},StaticRec:{intlName:"feed.RECOMMENDED"},SelfBatch:null,UploadBatch:null,GroupBatch:{intlName:"feed.GROUPS_ACTIVITY_LABEL"},ad:{intlName:"feed.SPONSORED"},StaticContent_Sponsored:{intlName:"feed.SPONSORED"},StaticContent_General:null,StaticContent_Help:null},PER_BATCH:15,AD_CADENCE:7,getCappedPhotoHeight:function(e){e.height;return Math.min(e.height,Math.max(t.viewportData.getHeight()*e.viewportProportion-e.additionalCardHeight,e.minHeight))},getEventTypeName:function(e){var t=this.EVENT_TYPE_INTL[e];return t?a.intlMessage(t):""},getItemAttribution:function(e){var t={};switch(e.eventType){case"Flickrec":case"StaticRec":case"SelfBatch":case"ad":case"StaticContent_Sponsored":break;case"UploadBatch":t={id:e.photoItems[0].owner.nsid,title:e.photoItems[0].owner.displayname,url:"/photos/"+e.photoItems[0].owner.pathAlias,iconUrl:e.photoItems[0].owner.buddyicon.default,isPro:e.photoItems[0].owner.isPro,proBadgeType:e.photoItems[0].owner.proBadgeType};break;case"GroupBatch":t={id:e.groupId,title:e.groupName,url:"/groups/"+e.groupId,iconUrl:e.iconUrls.default};break;case"StaticContent_General":t={title:a.intlMessage({intlName:"feed.FLICKR_EDITORIAL"}),url:e.staticContent.link};break;case"StaticContent_Help":t={title:a.intlMessage({intlName:"feed.FLICKR_HELP"}),url:e.staticContent.link}}return t.activityName=this.getEventTypeName(e.eventType),t.time=e.time,t},getLinkFooterConfig:function(e){var t={};switch(e.eventType){case"Flickrec":case"StaticRec":case"SelfBatch":case"ad":case"StaticContent_Sponsored":case"StaticContent_General":case"StaticContent_Help":break;case"UploadBatch":t={text:a.intlMessage({intlName:"feed.VIEW_IN_PHOTOSTREAM"}),url:"/photos/"+e.photoItems[0].owner.pathAlias};break;case"GroupBatch":t={text:a.intlMessage({intlName:"feed.VIEW_GROUP_POOL"}),url:"/groups/"+e.groupId+"/pool"}}return t},getEventTypes:function(e){var t="UploadBatch,GroupBatch,ContactRec";return e&&("groups"===e?t="GroupBatch":"people"===e?t="UploadBatch,ContactRec":"friends_and_family"===e&&(t="UploadBatch")),t},convertActivityModel:function(t){var a=this,n=t.getValue("photos").getList(),r=t.getValue("people"),o={id:e.guid(),layoutRenderType:"feedCard",batchId:t.getValue("id"),eventType:t.getValue("eventType"),owner:{nsid:t.getValue("ownerId")},isRecommended:t.getValue("recommended"),isStaticContent:t.getValue("isStaticContent"),isStaticHelp:t.getValue("isStaticHelp"),time:t.getValue("time"),count:t.getValue("count"),model:t};return"GroupBatch"===o.eventType&&(o.groupId=t.getValue("groupId"),o.groupName=t.getValue("groupName"),o.iconUrls=t.getValue("iconUrls")),o.eventType.indexOf("StaticContent")>-1&&(o.staticContent=t.getValue("data")),o.photoItems=n.map((function(e){return a.photoCardHelper.convertPhotoModel(e)})),r&&(o.personItems=r.map((function(e){return a.convertPerson(e)}))),o},convertPerson:function(t){var a=t.model,n=a.getValue("isPro");return{id:e.guid(),nsid:a.getValue("nsid"),url:a.getValue("url"),displayname:a.getValue("displayname"),username:a.getValue("username"),buddyicon:a.getValue("buddyicon"),pathAlias:a.getValue("pathAlias"),isPro:n,proBadgeType:n?a.getValue("proBadge"):void 0,coverPhotoUrls:t.coverPhotoUrls,model:a}},generateListsFromItems:function(e){var t=0,a=[];return e.forEach((function(n,r){"ContactRec"===n.eventType||"ad"===n.eventType?(r>t&&a.push({layoutRenderType:"activityCard",items:e.slice(t,r)}),a.push({layoutRenderType:"ad"===n.eventType?"ad":"people",items:[e[r]]}),t=r+1):r===e.length-1&&a.push({layoutRenderType:"activityCard",items:e.slice(t,r+1)})})),a},promiseSync:function(t,a){var n=this,r=t.shift();return a=a||[],r?r().then((function(e){return a.push(e),n.promiseSync(t,a)})):e.Promise.resolve(a)},getEmptyStateMessage:function(t,n){var o;switch(t){case"all":o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.NO_ACTIVITY_RIGHT_NOW"}),message:a.intlMessage({intlName:"feed.CHECK_OUT_RECS_BELOW"})});break;case"groups":o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.EMPTY_GROUPS_1"}),message:a.intlMessage({intlName:"feed.EMPTY_GROUPS_2",groupsUrl:"/groups"})});break;case"people":o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.EMPTY_PEOPLE_1"}),message:a.intlMessage({intlName:"feed.CHECK_OUT_RECS_BELOW"})});break;case"friends_and_family":o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.EMPTY_FRIENDS_AND_FAMILY_1"}),message:a.intlMessage({intlName:"feed.EMPTY_FRIENDS_AND_FAMILY_2",peopleUrl:e.URLHelper.generatePersonUrls(n).list})});break;default:o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.NO_ACTIVITY_RIGHT_NOW"}),message:a.intlMessage({intlName:"feed.NO_ACTIVITY_RIGHT_NOW"})})}return o}};return e.augment(o,e.EventTarget),o}}),"@VERSION@",{requires:["event-custom","storage-helper","photo-card-helper","url-helper","fluid-share-photo-view","fluid-share-photostream-view","hermes-template-feed-error-message"]});YUI.add("hermes-template-reboot-welcome-dialog-content",(function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,o,a){return"\tWhile we continue to develop the beta experience, we want your feedback. In case you need some of the missing functionality, you can easily opt-out and go back to the old experience.\n"},3:function(e,t,n,o,a){return"\tPlease continue providing us with feedback so we can continue to improve Flickr.\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,o,a){var r,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"Flickr is about the amazing photos you capture and the communities that you build around these photos. The goal of our photo page redesign is to provide you with a fast photo browsing experience and an easy interface to build &amp; maintain relationships.<br>\n<br>\nOver the last 4 weeks, we received a lot of feedback from the Flickr community regarding the photo page design. Based on the feedback, we are experimenting with different variations of the photo page to identify the best experience.<br>\n<br>\n"+(null!=(r=i(n,"if").call(null!=t?t:e.nullContext||{},null!=t?i(t,"opt-out-enabled"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(3,a,0),data:a,loc:{start:{line:5,column:0},end:{line:9,column:7}}}))?r:"")+"<br>"},useData:!0}),o={};e.Array.each([],(function(t){var n=e.Template.get("hermes/"+t);n&&(o[t]=n)})),e.Template.register("hermes/reboot-welcome-dialog-content",(function(t,a){return(a=a||{}).partials=a.partials?e.merge(o,a.partials):o,n(t,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-opt-out",(function(e,t){var n=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,n,l,r){var a,o=null!=t?t:e.nullContext||{},u=e.hooks.helperMissing,i="function",p=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<form action="//'+p(typeof(a=null!=(a=s(n,"host")||(null!=t?s(t,"host"):t))?a:u)===i?a.call(o,{name:"host",hash:{},data:r,loc:{start:{line:1,column:16},end:{line:1,column:24}}}):a)+'/help/optin" method="post">\n\t<input type="hidden" name="photo_opt" value="0">\n\t<input type="hidden" name="redirect_url" value="'+p(typeof(a=null!=(a=s(n,"redirect-url")||(null!=t?s(t,"redirect-url"):t))?a:u)===i?a.call(o,{name:"redirect-url",hash:{},data:r,loc:{start:{line:3,column:49},end:{line:3,column:65}}}):a)+'">\n\t<input type="submit" class="ui-button" value="Go back to the old experience">\n</form>'},useData:!0}),l={};e.Array.each([],(function(t){var n=e.Template.get("hermes/"+t);n&&(l[t]=n)})),e.Template.register("hermes/photo-opt-out",(function(t,r){return(r=r||{}).partials=r.partials?e.merge(l,r.partials):l,n(t,r)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-well-media",(function(n,l){var t=n.Template.Handlebars.revive({1:function(n,l,t,e,a){var o,i=null!=l?l:n.nullContext||{},s=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t<div class="restricted-interstitial">\n\t\t<div class="restricted-interstitial-message">\n\t\t\t<h2>'+n.escapeExpression((s(t,"intlMessage")||l&&s(l,"intlMessage")||n.hooks.helperMissing).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADULT_CONTENT"},data:a,loc:{start:{line:4,column:7},end:{line:4,column:66}}}))+"</h2>\n"+(null!=(o=s(t,"if").call(i,null!=l?s(l,"isSignedIn"):l,{name:"if",hash:{},fn:n.program(2,a,0),inverse:n.program(5,a,0),data:a,loc:{start:{line:5,column:3},end:{line:14,column:10}}}))?o:"")+"\t\t</div>\n\t</div>\n"},2:function(n,l,t,e,a){var o,i=null!=l?l:n.nullContext||{},s=n.hooks.helperMissing,r=n.escapeExpression,c=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t\t\t<p>"+r((c(t,"intlMessage")||l&&c(l,"intlMessage")||s).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.MATURE_AUDIENCES"},data:a,loc:{start:{line:6,column:7},end:{line:6,column:69}}}))+"<br />"+r((c(t,"intlMessage")||l&&c(l,"intlMessage")||s).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.USER_DISCRETION"},data:a,loc:{start:{line:6,column:75},end:{line:6,column:136}}}))+"</p>\n\n"+(null!=(o=c(t,"unless").call(i,null!=l?c(l,"isMinor"):l,{name:"unless",hash:{},fn:n.program(3,a,0),inverse:n.noop,data:a,loc:{start:{line:8,column:4},end:{line:11,column:15}}}))?o:"")},3:function(n,l,t,e,a){var o=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,s=n.escapeExpression,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t\t\t\t<p><button class='ui-button'><span>"+s((r(t,"intlMessage")||l&&r(l,"intlMessage")||i).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SHOW_ME_THIS_CONTENT_TYPE"},data:a,loc:{start:{line:9,column:40},end:{line:9,column:111}}}))+"</span></button></p>\n\t\t\t\t\t<p>"+s((r(t,"intlHTMLMessage")||l&&r(l,"intlHTMLMessage")||i).call(o,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"},data:a,loc:{start:{line:10,column:8},end:{line:10,column:88}}}))+"</p>\n"},5:function(n,l,t,e,a){var o,i=null!=l?l:n.nullContext||{},s=n.hooks.helperMissing,r=n.escapeExpression,c=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t\t\t<p>"+r((c(t,"intlMessage")||l&&c(l,"intlMessage")||s).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SIGNED_IN_FOR_CONTENT"},data:a,loc:{start:{line:13,column:7},end:{line:13,column:74}}}))+' <a href="//'+r("function"==typeof(o=null!=(o=c(t,"host")||(null!=l?c(l,"host"):l))?o:s)?o.call(i,{name:"host",hash:{},data:a,loc:{start:{line:13,column:86},end:{line:13,column:94}}}):o)+'/signin/" data-track="photoWellSignInClick">'+r((c(t,"intlMessage")||l&&c(l,"intlMessage")||s).call(i,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:a,loc:{start:{line:13,column:138},end:{line:13,column:179}}}))+"</a></p>\n"},7:function(n,l,t,e,a){var o,i=null!=l?l:n.nullContext||{},s=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\n"+(null!=(o=s(t,"if").call(i,null!=l?s(l,"isVideo"):l,{name:"if",hash:{},fn:n.program(8,a,0),inverse:n.program(11,a,0),data:a,loc:{start:{line:19,column:2},end:{line:36,column:9}}}))?o:"")+(null!=(o=s(t,"if").call(i,null!=l?s(l,"isAd"):l,{name:"if",hash:{},fn:n.program(14,a,0),inverse:n.noop,data:a,loc:{start:{line:37,column:1},end:{line:40,column:8}}}))?o:"")},8:function(n,l,t,e,a){var o,i,s=null!=l?l:n.nullContext||{},r=n.hooks.helperMissing,c="function",u=n.escapeExpression,h=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t<div class="videoplayer main-photo" style="width:'+u(typeof(i=null!=(i=h(t,"width")||(null!=l?h(l,"width"):l))?i:r)===c?i.call(s,{name:"width",hash:{},data:a,loc:{start:{line:20,column:52},end:{line:20,column:61}}}):i)+"px; height:"+u(typeof(i=null!=(i=h(t,"height")||(null!=l?h(l,"height"):l))?i:r)===c?i.call(s,{name:"height",hash:{},data:a,loc:{start:{line:20,column:72},end:{line:20,column:82}}}):i)+'px;"><video id="video_1" poster="'+u(typeof(i=null!=(i=h(t,"src")||(null!=l?h(l,"src"):l))?i:r)===c?i.call(s,{name:"src",hash:{},data:a,loc:{start:{line:20,column:115},end:{line:20,column:122}}}):i)+'" class="video-js vjs-big-play-centered inherit-size '+(null!=(o=(h(t,"isFlipped")||l&&h(l,"isFlipped")||r).call(s,"enable-photo-page-lightbox-updates",{name:"isFlipped",hash:{},fn:n.program(9,a,0),inverse:n.noop,data:a,loc:{start:{line:20,column:175},end:{line:20,column:273}}}))?o:"")+'"></video></div>\n'},9:function(n,l,t,e,a){return"vjs-show-big-play-button-on-pause"},11:function(n,l,t,e,a){var o,i,s=null!=l?l:n.nullContext||{},r=n.hooks.helperMissing,c=n.escapeExpression,u="function",h=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\n\t\t\t<div class="facade-of-protection-neue '+(null!=(o=h(t,"if").call(s,null!=l?h(l,"is-video"):l,{name:"if",hash:{},fn:n.program(12,a,0),inverse:n.noop,data:a,loc:{start:{line:23,column:41},end:{line:23,column:72}}}))?o:"")+'">\n\t\t\t\t'+c((h(t,"outlet")||l&&h(l,"outlet")||r).call(s,null!=l?h(l,"zoom-view"):l,{name:"outlet",hash:{},data:a,loc:{start:{line:24,column:4},end:{line:24,column:24}}}))+'\n\t\t\t</div>\n\n\t\t\t<img width="'+c(typeof(i=null!=(i=h(t,"width")||(null!=l?h(l,"width"):l))?i:r)===u?i.call(s,{name:"width",hash:{},data:a,loc:{start:{line:27,column:15},end:{line:27,column:24}}}):i)+'" height="'+c(typeof(i=null!=(i=h(t,"height")||(null!=l?h(l,"height"):l))?i:r)===u?i.call(s,{name:"height",hash:{},data:a,loc:{start:{line:27,column:34},end:{line:27,column:44}}}):i)+'" src="'+c(typeof(i=null!=(i=h(t,"src")||(null!=l?h(l,"src"):l))?i:r)===u?i.call(s,{name:"src",hash:{},data:a,loc:{start:{line:27,column:51},end:{line:27,column:58}}}):i)+'" class="low-res-photo" alt="'+c(typeof(i=null!=(i=h(t,"imgAltText")||(null!=l?h(l,"imgAltText"):l))?i:r)===u?i.call(s,{name:"imgAltText",hash:{},data:a,loc:{start:{line:27,column:87},end:{line:27,column:101}}}):i)+'">\n\t\t\t<img width="'+c(typeof(i=null!=(i=h(t,"width")||(null!=l?h(l,"width"):l))?i:r)===u?i.call(s,{name:"width",hash:{},data:a,loc:{start:{line:28,column:15},end:{line:28,column:24}}}):i)+'" height="'+c(typeof(i=null!=(i=h(t,"height")||(null!=l?h(l,"height"):l))?i:r)===u?i.call(s,{name:"height",hash:{},data:a,loc:{start:{line:28,column:34},end:{line:28,column:44}}}):i)+'" src="'+c(typeof(i=null!=(i=h(t,"highResSrc")||(null!=l?h(l,"highResSrc"):l))?i:r)===u?i.call(s,{name:"highResSrc",hash:{},data:a,loc:{start:{line:28,column:51},end:{line:28,column:65}}}):i)+'" class="main-photo is-hidden" alt="'+c(typeof(i=null!=(i=h(t,"imgAltText")||(null!=l?h(l,"imgAltText"):l))?i:r)===u?i.call(s,{name:"imgAltText",hash:{},data:a,loc:{start:{line:28,column:101},end:{line:28,column:115}}}):i)+'">\n\t\t\t<script nonce="'+c(typeof(i=null!=(i=h(t,"cspNonce")||(null!=l?h(l,"cspNonce"):l))?i:r)===u?i.call(s,{name:"cspNonce",hash:{},data:a,loc:{start:{line:29,column:18},end:{line:29,column:30}}}):i)+"\">\n\t\t\tvar img = document.querySelector('.photo-well-media-view img.main-photo');\n\t\t\timg.onload = function () { registerFirstPhoto(img); };\n\t\t\t<\/script>\n\t\t\t<noscript>\n\t\t\t\t<img width=\""+c(typeof(i=null!=(i=h(t,"width")||(null!=l?h(l,"width"):l))?i:r)===u?i.call(s,{name:"width",hash:{},data:a,loc:{start:{line:34,column:16},end:{line:34,column:25}}}):i)+'" height="'+c(typeof(i=null!=(i=h(t,"height")||(null!=l?h(l,"height"):l))?i:r)===u?i.call(s,{name:"height",hash:{},data:a,loc:{start:{line:34,column:35},end:{line:34,column:45}}}):i)+'" src="'+c(typeof(i=null!=(i=h(t,"highResSrc")||(null!=l?h(l,"highResSrc"):l))?i:r)===u?i.call(s,{name:"highResSrc",hash:{},data:a,loc:{start:{line:34,column:52},end:{line:34,column:66}}}):i)+'" class="main-photo" alt="'+c(typeof(i=null!=(i=h(t,"imgAltText")||(null!=l?h(l,"imgAltText"):l))?i:r)===u?i.call(s,{name:"imgAltText",hash:{},data:a,loc:{start:{line:34,column:92},end:{line:34,column:106}}}):i)+'">\n\t\t\t</noscript>\n'},12:function(n,l,t,e,a){return"is-video"},14:function(n,l,t,e,a){var o,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t<span class="ad-info">'+n.escapeExpression((i(t,"intlHTMLMessage")||l&&i(l,"intlHTMLMessage")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},{name:"intlHTMLMessage",hash:{brand:null!=(o=null!=l?i(l,"ad"):l)?i(o,"brand"):o,intlName:"photo-page-scrappy.FIND_OUT_MORE_AD"},data:a,loc:{start:{line:38,column:25},end:{line:38,column:106}}}))+"</span>\n\t\t</a>\n"},compiler:[8,">= 4.3.0"],main:function(n,l,t,e,a){var o,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=i(t,"if").call(null!=l?l:n.nullContext||{},null!=l?i(l,"needsInterstitial"):l,{name:"if",hash:{},fn:n.program(1,a,0),inverse:n.program(7,a,0),data:a,loc:{start:{line:1,column:0},end:{line:41,column:7}}}))?o:""},useData:!0}),e={};n.Array.each([],(function(l){var t=n.Template.get("hermes/"+l);t&&(e[l]=t)})),n.Template.register("hermes/photo-well-media",(function(l,a){return(a=a||{}).partials=a.partials?n.merge(e,a.partials):e,t(l,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-well-media-view",(function(e,t){var i,o=require("hermes-core/flog")(t);i={photo:{render:function(){var t,i,o=this,n=this.get("photo"),a=new Date,s="";return o.preloadImage&&(o.preloadImage.onload=null),t=this.getPhotoForDisplay(),i=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]}),n.getValue("owner")&&(s=""===n.getValue("title").trim()?this.intlMessage({intlName:"common.UNTITLED"}):n.getValue("title"),s+=" | "+this.intlMessage({intlName:"common.BY_USER",user:n.getValue("owner").getValue("username")})),this.setContainerWithTemplate("photo-well-media",{width:t.width,height:t.height,src:i.url,highResSrc:t.url,imgAltText:s,needsInterstitial:n.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:n.getValue("isVideo"),isMinor:this.appContext.getViewer().isMinor,isAd:this.isAd}),this.fire("subviewViewEvent",t),YUI.Env.isServer?(this.serverWidth=t.width,this.serverHeight=t.height):n.getValue("needsInterstitial")||(o.preloadImage=new Image,o.preloadImage.onload=function(){if(!this.onloadFired&&o.isActiveAndInDOM()){this.onloadFired=!0;var i,n="photoPageShowedSize",s="Ã¸";try{(i=/(?:_([a-z]))?\.jpg/.exec(t.url))&&i[1]&&(s=i[1])}catch(e){}finally{n+=String(s).toUpperCase()}e.rapidTracker.beacon(this.name,n);var r,l=o.get("container").one(".low-res-photo"),h=o.get("container").one(".main-photo");new Date-a<100?(h.removeClass("is-hidden").show(),l.hide()):(h.setStyles({position:"absolute",left:0,top:0,opacity:0}),h.removeClass("is-hidden"),r=function(){h.removeAttribute("style"),l.hide()},e.UA.ie?r():e.use("transition",(function(e){h.transition({duration:.25,opacity:1},r)})))}},o.preloadImage.src=t.url,o.preloadImage.complete&&o.preloadImage.onload()),this}},video:{render:function(){var e=this.get("photo"),t=this.getPhotoForDisplay({excludeSizes:[]}),i=t.url;return this.appContext.flipper.isFlipped("disable-video-playback")&&(i="/images/en-us/video-unavailable/m.png"),!this.player||e.getValue("isVideoPending")||e.getValue("isVideoFailed")?(this.setContainerWithTemplate("photo-well-media",{width:t.width,height:t.height,src:i,needsInterstitial:e.getValue("needsInterstitial"),isVideo:e.getValue("isVideo"),isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this.fire("subviewViewEvent",t),this):(e.getValue("isVideoPending")||e.getValue("isVideoFailed")||(this.player.dimension?(this.player.dimension("width",t.width),this.player.dimension("height",t.height)):this.player.resize(t.width,t.height)),this)}},ad:{render:function(){return this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disableIfSmall:!0}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.ad=e.ad,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var t=this;return this.appContext.getModel("photo-models",t.photoId).then((function(i){if(t.set("photo",i),i.getValue("isVideo"))return new e.Promise((function(t,i){e.use("flickr-video-player",(function(){t()}))}))}))},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?i.ad.render.call(this):i[this.get("photo").getValue("isVideo")?"video":"photo"].render.call(this),this},handleInterstitialDismissButtonClick:function(t){var i=this,n=this.get("personPreferences"),a=this.get("photo"),s=a.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),n.setValue("safeSearch",s),n.registry.remoteUpdate(i.appContext.auth.user.nsid).then((function(e){a.registry.attributeSearch({needsInterstitial:!0}).forEach((function(e){a.registry.getValue(e,"safetyLevel")<=n.getValue("safeSearch")&&a.registry.setValue(e,"needsInterstitial",!1)})),i.buildContainer()}),(function(e){o.error({err:e}),i.onError(i.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))}))},activate:function(){var t,i=this,o=i.get("photo"),n=this.getPhotoForDisplay(),a=this.get("container").one(".main-photo");return!o.getValue("isVideo")||o.getValue("isVideoPending")||o.getValue("isVideoFailed")||(i.player=new e.FlickrVideoPlayer({container:i.get("container").one(".videoplayer"),model:o,appContext:i.appContext,videoNode:e.one("#video_1")?e.one("#video_1")._node:null,autoplay:!0,loop:!0,controlBar:{fullscreenToggle:!1}}),i.player.init().then((function(){if(this.appContext.flipper.isFlipped("enable-photo-page-lightbox-updates")){i.player.player.controlBar.dispose();var e=i.player.player.addChild("ControlBar",{fullscreenToggle:!1});i.player.player.on("pause",(()=>{i.player.player.seeking()||i.fire("subviewViewEvent","videoPause")})),i.player.player.on("play",(()=>{i.fire("subviewViewEvent","videoPlay")})),i.player.player.on("touchend",(()=>{i.player.player.paused?i.player.play():i.player.pause()})),i.fire("subviewViewEvent","videoPlayerInitialized",e)}})),i.on("destroy",(function(){i.player&&(i.player.destroy(),i.player=null)}))),o.getValue("needsInterstitial")||(e.use("global-events",(function(e){i.registerEventHandler(e.globalEvents.subscribe("window:resize",(function(e){i.set("canvasSizeIsDirty",!0),i.buildContainer()})))})),this.registerEventHandler(e.on("flickr:photo-media-well-update",(function(e){i.set("canvasSizeIsDirty",!0),i.buildContainer()}))),!this.isAd&&(!i.get("clientRendered")||a&&n.width!==Number(a.getAttribute("width"))||a&&n.height!==Number(a.getAttribute("height")))&&i.buildContainer()),this.registerEventHandler(e.on("flickr:display-note-box",(function(o){t=e.Node.create('<div class="note-box"></div>'),i.get("container").one(".main-photo").getXY(),i.get("container").append(t),t.setStyles({top:o.noteBoxTop+i.get("container").one(".main-photo").getDOMNode().offsetTop,left:o.noteBoxLeft,width:o.noteBoxWidth,height:o.noteBoxHeight})}))),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",i.appContext.auth.user.nsid).then((function(e){i.set("personPreferences",e),o.getValue("needsInterstitial")&&!this.appContext.getViewer().isMinor&&i.registerEventHandler(i.get("container").one(".restricted-interstitial-message button").on("click",i.handleInterstitialDismissButtonClick,i))})),this},onError:function(t){new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:this.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),htmlMessage:t}).show()},getPhotoForDisplay:function(e){var t,i,o=this.getCanvasSize(),n=this.getPixelRatio(),a=this.get("photo").getSizeToFit(o,e);return t=Math.min(o.height/n,a.height),i=Math.min(o.width/n,a.width/a.height*t),t=Math.min(t,a.height/a.width*i),{width:Math.round(i),height:Math.round(t),url:a.url,pixelRatio:a.width/i}},getCanvasSize:function(){var e,t,i=this.getPixelRatio();return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(t=this.get("container").ancestor())&&(e=t.get("region")).width>0&&e.height>0&&(this.set("canvasSizeIsDirty",!1),this.set("cachedCanvasSize",e),this.appContext.setCookie({remove:!0,cookieName:"photoPW",path:"/photos/",cookieValue:e.width}),this.appContext.setCookie({remove:!0,cookieName:"photoPH",path:"/photos/",cookieValue:e.height}),this.appContext.setCookie({remove:!0,cookieName:"density",path:"/photos/",cookieValue:i})):e=this.get("cachedCanvasSize"),e||(e={top:0,left:0,bottom:500,right:500,width:parseInt(this.appContext.getCookie("photoPW"),10)||500,height:parseInt(this.appContext.getCookie("photoPH"),10)||500}),e.height*=i,e.width*=i,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-well-media","moment","zoom-view"],optionalRequires:["hermes-core"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});